{% extends "layouts/base.html" %}

{% block title %}Authorize agent wallet ‚Äî Hyperliquid Bot{% endblock %}

{% block content %}
  <section class="agent-hero ui-card ui-card--surface">
    <div class="agent-hero__body">
      <div class="agent-hero__eyebrow">Agent authorization</div>
      <h1 class="agent-hero__title">Connect your Hyperliquid agent wallet</h1>
      <p class="agent-hero__copy">
        Agents let the platform trade programmatically on Hyperliquid using your delegated API wallet.
        Your main wallet keeps custody‚Äîagents cannot withdraw on L1. Follow the checklist to authorize an
        agent and vault its credentials with server-side encryption.
      </p>
      <div class="agent-hero__cta">
        <a class="ui-button ui-button--primary" href="{{ agent_deep_link }}" target="_blank" rel="noopener">
          Open Hyperliquid API portal
        </a>
        <p class="agent-hero__caption">
          Deep link opens <code>app.hyperliquid.xyz/API</code> in a new tab so you can create or manage API wallets.
        </p>
      </div>
    </div>
    <div class="agent-hero__illust" aria-hidden="true">
      <div class="agent-orb"></div>
      <div class="agent-orb agent-orb--secondary"></div>
    </div>
  </section>

  <section class="agent-steps info-grid" aria-labelledby="agent-steps-heading">
    <h2 id="agent-steps-heading" class="section-title">3-step authorization checklist</h2>
    <div class="info-grid__items info-grid__items--compact">
      <article class="ui-card">
        <header class="ui-card__header">
          <h3 class="ui-card__title">Create agent wallet</h3>
          <span class="ui-card__kicker">Step 1</span>
        </header>
        <p class="ui-card__body">
          In Hyperliquid, open the <strong>API</strong> page and select <em>Create API wallet</em>.
          Confirm with your primary wallet. Copy the generated <strong>agent address</strong> and <strong>private key</strong>.
        </p>
      </article>
      <article class="ui-card">
        <header class="ui-card__header">
          <h3 class="ui-card__title">Authorize trading scope</h3>
          <span class="ui-card__kicker">Step 2</span>
        </header>
        <p class="ui-card__body">
          Review the capabilities you are granting. Agents can place orders and perform internal transfers but
          <strong>cannot withdraw on L1</strong>. Confirm authorization in Hyperliquid‚Äôs UI.
        </p>
      </article>
      <article class="ui-card">
        <header class="ui-card__header">
          <h3 class="ui-card__title">Register with the bot</h3>
          <span class="ui-card__kicker">Step 3</span>
        </header>
        <p class="ui-card__body">
          Paste the agent metadata below so this server can encrypt and store it. Signed audit logs keep track of every
          agent registration event for compliance.
        </p>
      </article>
    </div>
  </section>

  <section class="agent-form-card ui-card ui-card--surface" aria-labelledby="agent-form-heading">
    <header class="ui-card__header">
      <div>
        <span class="ui-card__kicker">Secure storage</span>
        <h2 id="agent-form-heading" class="ui-card__title">Register agent credentials</h2>
      </div>
      <p class="ui-card__body">
        Provide a memorable label, agent wallet address, and the private key generated by Hyperliquid.
        Credentials are encrypted immediately and never displayed after submission.
      </p>
    </header>

    <form
      class="agent-form"
      hx-post="/authz/agent"
      hx-target="#agent-form-status"
      hx-swap="innerHTML"
    >
      <div class="agent-form__grid">
        <label class="ui-field">
          <span class="ui-field__label">Label</span>
          <input name="label" type="text" placeholder="Primary bot" required maxlength="64" />
          <small class="ui-field__hint">Example: ‚ÄúMomentum Bot ¬∑ Testnet‚Äù.</small>
        </label>
        <label class="ui-field">
          <span class="ui-field__label">Agent address</span>
          <input name="agent_address" type="text" placeholder="0x..." required pattern="0x[a-fA-F0-9]{40}" />
          <small class="ui-field__hint">Paste the 0x-prefixed agent wallet address.</small>
        </label>
        <label class="ui-field ui-field--full">
          <span class="ui-field__label">Private key</span>
          <input name="private_key" type="password" placeholder="0x..." required pattern="0x[a-fA-F0-9]{64}" />
          <small class="ui-field__hint">Stored encrypted. Key is never returned or shown again.</small>
        </label>
      </div>
      <div class="agent-form__actions">
        <button class="ui-button ui-button--primary" type="submit">Register agent</button>
        <button class="ui-button" type="reset">Clear form</button>
        <div id="agent-form-status" class="agent-form__status" role="status" aria-live="polite"></div>
      </div>
    </form>

    <aside class="agent-alert">
      <div class="agent-alert__icon" aria-hidden="true">üîí</div>
      <div class="agent-alert__body">
        <h3 class="agent-alert__title">Security notes</h3>
        <ul class="agent-alert__list">
          <li>Only use API wallets created on Hyperliquid; never paste your primary wallet key.</li>
          <li>Agent keys are encrypted at rest with server-managed secrets and can be rotated at any time.</li>
          <li>Prefer rotating agents between bot runs to avoid nonce collisions and keep audit trails clean.</li>
        </ul>
      </div>
    </aside>
  </section>
{% endblock %}
